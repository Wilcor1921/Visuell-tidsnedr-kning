<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visuell Tidsnedräknare</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #222;
    color: white;
  }
  header {
    background: #333;
    padding: 10px;
    position: sticky;
    top: 0;
    z-index: 1000;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  .controls label {
    display: flex;
    flex-direction: column;
    font-size: 14px;
  }
  .total-time {
    font-size: 28px;
    font-weight: bold;
    margin-left: auto;
    margin-right: 10px;
  }
  main {
    padding: 20px;
  }
  .lamp-container {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    justify-content: center;
    margin-top: 20px;
  }
  .lamp {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #555;
    transition: background-color 0.5s;
  }
  .timer-display {
    text-align: center;
    font-size: 48px;
    margin-top: 20px;
  }
  button {
    padding: 8px 16px;
    font-size: 16px;
    cursor: pointer;
  }
</style>
</head>
<body>

<header>
  <div class="controls">
    <label>
      Lampor:
      <input type="number" id="lampCount" value="15" min="1">
    </label>
    <label>
      Minuter/lampa:
      <input type="number" id="minutesPerLamp" value="2" min="0.1" step="0.1">
    </label>
    <label>
      Lampor per rad:
      <input type="number" id="lampsPerRow" value="5" min="1">
    </label>
    <label>
      Färgtema:
      <select id="colorTheme">
        <option value="gyr">Grön → Gul → Röd</option>
        <option value="rainbow">Regnbåge</option>
        <option value="white">Vit / Av</option>
      </select>
    </label>
    <div class="total-time" id="totalTimeDisplay"></div>
    <button id="startBtn">Starta i fullskärm</button>
  </div>
</header>

<main>
  <div class="lamp-container" id="lampContainer"></div>
  <div class="timer-display" id="timerDisplay">00:00</div>
</main>

<script>
  const lampContainer = document.getElementById('lampContainer');
  const lampCountInput = document.getElementById('lampCount');
  const minutesPerLampInput = document.getElementById('minutesPerLamp');
  const lampsPerRowInput = document.getElementById('lampsPerRow');
  const colorThemeSelect = document.getElementById('colorTheme');
  const timerDisplay = document.getElementById('timerDisplay');
  const totalTimeDisplay = document.getElementById('totalTimeDisplay');
  const startBtn = document.getElementById('startBtn');

  let lamps = [];
  let timerInterval;
  let currentLamp = 0;
  let demoPlayed = false;

  function updateTotalTime() {
    const total = (parseFloat(lampCountInput.value) * parseFloat(minutesPerLampInput.value)).toFixed(1);
    totalTimeDisplay.textContent = `${total} min`;
  }

  function createLamps() {
    lampContainer.innerHTML = '';
    lamps = [];
    const count = parseInt(lampCountInput.value);
    for (let i = 0; i < count; i++) {
      const lamp = document.createElement('div');
      lamp.classList.add('lamp');
      lampContainer.appendChild(lamp);
      lamps.push(lamp);
    }
  }

  function getLampColor(index, total) {
    const theme = colorThemeSelect.value;
    const ratio = index / (total - 1);
    if (theme === 'gyr') {
      const r = Math.floor(255 * ratio);
      const g = Math.floor(255 * (1 - ratio));
      return `rgb(${r},${g},0)`;
    } else if (theme === 'rainbow') {
      const hue = Math.floor(ratio * 360);
      return `hsl(${hue},100%,50%)`;
    } else {
      return index <= currentLamp ? '#fff' : '#555';
    }
  }

  function playDemo() {
    if (demoPlayed) return;
    demoPlayed = true;
    let i = 0;
    const demoInterval = setInterval(() => {
      lamps.forEach((lamp, idx) => {
        lamp.style.backgroundColor = idx <= i ? getLampColor(idx, lamps.length) : '#555';
      });
      i++;
      if (i >= lamps.length) clearInterval(demoInterval);
    }, 100);
  }

  function startTimer() {
    currentLamp = 0;
    let totalSeconds = parseFloat(lampCountInput.value) * parseFloat(minutesPerLampInput.value) * 60;
    const secondsPerLamp = totalSeconds / lamps.length;

    document.documentElement.requestFullscreen?.();

    timerInterval = setInterval(() => {
      totalSeconds--;
      const mins = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      const secs = String(totalSeconds % 60).padStart(2, '0');
      timerDisplay.textContent = `${mins}:${secs}`;

      currentLamp = Math.floor((parseFloat(lampCountInput.value) * parseFloat(minutesPerLampInput.value) * 60 - totalSeconds) / secondsPerLamp);
      lamps.forEach((lamp, idx) => {
        lamp.style.backgroundColor = idx <= currentLamp ? getLampColor(idx, lamps.length) : '#555';
      });

      if (totalSeconds <= 0) {
        clearInterval(timerInterval);
        alert('Tiden är slut!');
      }
    }, 1000);
  }

  lampCountInput.addEventListener('input', () => { createLamps(); updateTotalTime(); demoPlayed = false; playDemo(); });
  minutesPerLampInput.addEventListener('input', () => { createLamps(); updateTotalTime(); demoPlayed = false; playDemo(); });
  lampsPerRowInput.addEventListener('input', () => { createLamps(); updateTotalTime(); demoPlayed = false; playDemo(); });
  colorThemeSelect.addEventListener('change', () => { createLamps(); updateTotalTime(); demoPlayed = false; playDemo(); });

  startBtn.addEventListener('click', startTimer);

  // Init
  createLamps();
  updateTotalTime();
  playDemo();
</script>

</body>
</html>
