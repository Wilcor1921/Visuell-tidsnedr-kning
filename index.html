<!doctype html>
<html lang="sv">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>Visuell Tidsnedräknare</title>
<style>
:root {
  --bg: #0f1113;
  --panel: #171a1d;
  --panel2: #1a1d20ee;
  --text: #e7e9ea;
  --muted: #a7adb3;
  --border: #2b2f33;
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: sans-serif;
  background: var(--bg);
  color: var(--text);
}
#controls {
  padding: 10px;
  background: var(--panel);
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}
.control {
  display: flex;
  align-items: center;
  gap: 5px;
  background: var(--panel2);
  padding: 8px 12px;
  border-radius: 8px;
}
.control button {
  background: #333;
  color: white;
  border: none;
  padding: 6px 10px;
  font-size: 18px;
  border-radius: 6px;
}
.control span {
  min-width: 32px;
  text-align: center;
  font-weight: bold;
  font-size: 16px;
}
#totalTime {
  font-size: 24px;
  font-weight: bold;
  text-align: center;
  padding: 8px;
}
#lampWrap {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(20px, 1fr));
  gap: 6px;
  padding: 20px;
  justify-items: center;
}
.lamp {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: grey;
  transition: background 0.6s ease; /* mjukare */
}
.fullscreen-mode {
  background: var(--bg);
}
.fullscreen-mode #lampWrap {
  height: 100vh;
  width: 100vw;
  display: grid;
  place-items: center;
  grid-template-columns: repeat(auto-fit, minmax(20px, 1fr));
  gap: 10px;
}
#fullscreenControls {
  position: fixed;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
}
#fullscreenControls button {
  background: #333;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 14px;
}
</style>
</head>
<body>

<div id="controls">
  <div class="control">
    <label>Lampor:</label>
    <button onclick="changeLamps(-1)">-</button>
    <span id="lampCount">15</span>
    <button onclick="changeLamps(1)">+</button>
  </div>
  <div class="control">
    <label>Min/lampa:</label>
    <button onclick="changeMinutes(-1)">-</button>
    <span id="minPerLamp">2</span>
    <button onclick="changeMinutes(1)">+</button>
  </div>
  <div class="control">
    <label>Färg:</label>
    <select id="colorMode" onchange="renderLamps()">
      <option value="ggr">Grön–Gul–Röd</option>
      <option value="rainbow">Regnbåge</option>
      <option value="white">Vit</option>
    </select>
  </div>
  <button onclick="startTimer()">Starta</button>
</div>

<div id="totalTime">Total tid: <span id="totalMin">30</span> min</div>

<div id="lampWrap"></div>

<div id="fullscreenControls" style="display:none;">
  <button onclick="togglePause()">
    <span id="pauseText">Pausa</span>
  </button>
  <button onclick="exitFullscreen()">Avsluta</button>
</div>

<script>
let lamps = 15;
let minutesPerLamp = 2;
let timerInterval;
let paused = false;
let currentLamp = 0;
let colorMode = 'ggr';

function changeLamps(delta) {
  lamps = Math.max(1, lamps + delta);
  document.getElementById('lampCount').textContent = lamps;
  updateTotal();
  renderLamps();
  startPreviewOnce();
}
function changeMinutes(delta) {
  minutesPerLamp = Math.max(1, minutesPerLamp + delta);
  document.getElementById('minPerLamp').textContent = minutesPerLamp;
  updateTotal();
  renderLamps();
  startPreviewOnce();
}
function updateTotal() {
  document.getElementById('totalMin').textContent = lamps * minutesPerLamp;
}
function lampColor(index) {
  if (colorMode === 'white') return 'white';
  if (colorMode === 'ggr') {
    let ratio = index / (lamps - 1);
    if (ratio < 0.5) {
      let g = 200;
      let r = Math.floor(255 * ratio * 2);
      return `rgb(${r},${g},0)`;
    } else {
      let r = 200;
      let g = Math.floor(200 - (ratio - 0.5) * 2 * 200);
      return `rgb(${r},${g},0)`;
    }
  }
  if (colorMode === 'rainbow') {
    let hue = (index / lamps) * 360;
    return `hsl(${hue},100%,50%)`;
  }
  return 'grey';
}
function renderLamps(activeCount=lamps) {
  colorMode = document.getElementById('colorMode').value;
  let wrap = document.getElementById('lampWrap');
  wrap.innerHTML = '';
  for (let i = 0; i < lamps; i++) {
    let div = document.createElement('div');
    div.className = 'lamp';
    div.style.transitionDelay = `${i * 0.05}s`; // liten fördröjning
    div.style.background = i < activeCount ? lampColor(i) : '#333';
    wrap.appendChild(div);
  }
}

}
function startPreviewOnce() {
  renderLamps();
}
function startTimer() {
  paused = false;
  currentLamp = 0;
  renderLamps(lamps);
  enterFullscreen();
  document.getElementById('fullscreenControls').style.display = 'flex';
  timerInterval = setInterval(() => {
    if (!paused) {
      currentLamp++;
      renderLamps(lamps - currentLamp);
      if (currentLamp >= lamps) {
        clearInterval(timerInterval);
      }
    }
  }, minutesPerLamp * 60 * 1000);
}
function togglePause() {
  paused = !paused;
  document.getElementById('pauseText').textContent = paused ? 'Fortsätt' : 'Pausa';
}
function enterFullscreen() {
  document.body.classList.add('fullscreen-mode');
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen();
  }
}
function exitFullscreen() {
  document.body.classList.remove('fullscreen-mode');
  clearInterval(timerInterval);
  document.getElementById('fullscreenControls').style.display = 'none';
  if (document.exitFullscreen) {
    document.exitFullscreen();
  }
}
window.onload = function() {
  updateTotal();
  renderLamps();
  startPreviewOnce();
};
</script>

</body>
</html>
